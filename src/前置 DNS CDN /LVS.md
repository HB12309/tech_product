## DNS

通过域名访问Internet上的网站或服务器需要使用DNS来进行解析。客户端电脑使用的DNS就是本地DNS服务器，本地DNS服务器会向权威DNS获取解析记录返回给用户，并按照解析记录TTL值缓存到自己服务器。本地DNS服务器一般是网络服务商提供的DNS，也可以自己修改为常用的公共DNS。

DSN: 同样的做法也可以借鉴到传统的BS架构中，我们也可以把用户的请求直接分流到不同的服务器上，而不必经过一个统一的节点中转。这个分流是通过什么做到的呢？

负载均衡可以分为两个层次

1、全局负载均衡（Global Server Load Balance, GSLB）,全局负载均衡是指对分别放置在不同的地理位置的服务器群间作负载均衡。GSLB实现方式有三种： DNS轮询（DNS轮询是真实返回内容服务器的IP）、HTTP重定向、IP欺骗（又称三角传输）

2、服务器负载均衡（Server Load Balance, SLB）服务器负载均衡是指对本地的服务器群做负载均衡。


## ISP服务商

对于域名的服务一般由各地的 ISP服务商 提供2-4个Dns域名服务器，供本地的上网者使用。

国内Internet由十大ISP的网络组成，各运营商在网络规模、用户数量和网上资源上差距很大，中国电信和中国网通分别在南方21个省区市和北方10个省区市居主导地位。

十大ISP服务商分为：

中国公用计算机互联网(CHINANET，即中国电信网)

中国网通公用互联网(CNCNET，包括金桥网CHINAGBN)

中国移动互联网（CMNET）

中国联通互联网（UNINET）

中国铁通互联网（CRCNET）

中国卫星集团互联网（CSNET）

中国科技网（CSTNET）

中国教育和科研计算机网（CERNET）

中国国际经济贸易互联网（CIETNET）

中国长城互联网（CGWNET）

景安网络（GAINET）

### DNS网络服务商、公共DNS服务器、各省运营商DNS服务器

各种云服务公司

云解析DNS（Alibaba Cloud DNS）是一种安全、快速、稳定、可扩展的权威DNS服务，云解析DNS为企业和开发者将易于管理识别的域名转换为计算机用于互连通信的数字IP地址，从而将用户的访问路由到相应的网站或应用服务器。 

114 DNS、阿里 AliDNS、CNNIC SDNS、oneDNS、Google DNS、OpenDNS、DNSPOD（腾讯家的公共DNS）

全国各地电信 DNS 服务器 IP 地址，安徽北京重庆福建
以下为全国各地联通 DNS 服务器 IP 地址

## DNS 负载均衡技术

DNS 负载均衡可能是构建网络服务群集的最简单方法。使用域名系统通过将域名解析为服务器的不同 IP 地址来将请求分发到不同的服务器

DNS 负载均衡技术的实现原理是：在 DNS 服务器中为同一个主机名配置多个 IP 地址，多个 IP 地址以轮询的方式选择。

直到现在，很多网站仍然使用DNS负载均衡来保证网站的运行和可访问性。从其实现和效果来看，主要有以下优缺点：

    主要优点

　　这种技术的主要缺点如下：

　　第一，技术实现比较灵活、方便，简单易行，成本低，适用于大多数TCP/IP应用。不需要网络专家来对之进行设定，或在出现问题时对之进行维护。

　　第二，对于Web应用来说，不需要对代码作任何的修改。事实上，Web应用本身并不会意识到负载均衡配置，即使在它面前。

　　第三，Web服务器可以位于互联网的任意位置上。

    主要缺点

　　DNS负载均衡技术在具有以上优点的时候，其缺点也非常明显，主要表现在：

　　第一，不能够按照Web服务器的处理能力分配负载。DNS负载均衡采用的是简单的轮循负载算法，不能区分服务器之间的差异，不能反映服务器的当前运行状态。所以DNS服务器将Http请求平均地分配到后台的Web服务器上，而不考虑每个Web服务器当前的负载情况。如果后台的Web服务器的配置和处理能力不同，最慢的 Web服务器将成为系统的瓶颈，处理能力强的服务器不能充分发挥作用。不能做到为性能较好的服务器多分配请求，甚至会出现客户请求集中在某一台服务器上的情况。

　　第二，不支持高可靠性，DNS负载均衡技术没有考虑容错。如果后台的某台Web服务器出现故障，DNS服务器仍然会把DNS 请求分配到这台故障服务器上，导致不能响应客户端。

　　第三，可能会造成额外的网络问题。为了使本DNS服务器和其他DNS服务器及时交互，保证DNS数据及时更新，使地址能随机分配，一般都要将DNS的刷新时间设置的较小，但太小将会使DNS流量大增造成额外的网络问题。

　　第四，一旦某个服务器出现故障，即使及时修改了DNS设置，还是要等待足够的时间(刷新时间)才能发挥作用，在此期间，保存了故障服务器地址的客户计算机将不能正常访问服务器。

总体来说，DNS负载均衡技术方案不应该算是真正意义上的负载均衡，不能够稳定、可靠、高效地满足企业对Web服务器的需求，也不能满足网络用户对网站访问的及时响应和可用性，所以现在很多Web站点方案中，已经很少采用这种方案了 

## 负载均衡器 LVS

f5 公司 收购了 nginx

搭建集群服务器通过整合多台普通的服务器设备并以同一个地址对外提供相同的服务，今天就带领大家学习企业中常用的一种群集技术 —— LVS。

lvs加 keepalived 做负载均衡

LVS 与 Nginx 功能对比

LVS 比 Nginx 具有更强的抗负载能力，性能高，对内存和 CPU 资源消耗较低；

LVS 工作在网络层，具体流量由操作系统内核进行处理，Nginx 工作在应用层，可针对 HTTP 应用实施一些分流策略；

LVS 安装配置较复杂，网络依赖性大，稳定性高。Nginx 安装配置较简单，网络依赖性小；

LVS 不支持正则匹配处理，无法实现动静分离效果。

LVS 适用的协议范围广。Nginx 仅支持 HTTP、HTTPS、Email 协议，适用范围小；

## nginx负载均衡


1）DNS 实现负载均衡

一个域名通过 DNS 解析到多个 IP，每个 IP 对应不同的服务器实例，就完成了流量的调度，这也是 DNS 实现负载均衡是最简单的方式。

使用该方式最大的优点：实现简单，成本低，无需自己开发或维护负载均衡设备，不过存在一些缺点：服务器故障切换延迟大，升级不方便、流量调度不均衡，粒度大、流量分配策略较简单，支持的算法较少、DNS 所支持的 IP 列表有限制要求。

2）硬件负载均衡

硬件负载均衡是通过专门的硬件设备从而来实现负载均衡功能，比如：交换机、路由器就是一个负载均衡专用的网络设备。

目前典型的硬件负载均衡设备有两款：F5 和 A10。不过话说，能用上这种硬件负载均衡设备的企业都不是一般的公司，反而普通业务量级小的其他企业基本用不到。

硬件负载均衡的优点：

功能强大：支持各层级负载均衡及全面负载均衡算法；

性能强大：性能远超常见的软件负载均衡器；

稳定性高：硬件负载均衡，大规模使用肯定是严格测试过的；

安全防护：除具备负载均衡功能外，还具备防火墙、防 DDoS 攻击等安全功能；

硬件负载均衡的缺点：

价格昂贵；

可扩展性差；

调试维护麻烦；

3）软件负载均衡

Nginx ：支持 4 层 / 7 层负载均衡，支持 HTTP、E-mail 协议；

LVS ：纯 4 层负载均衡，运行在内核态，性能是软件负载均衡中最高的；

HAproxy ：是 7 层负载均衡软件，支持 7 层规则的设置，性能也不错；

软件负载均衡的优点：

简单、灵活、便宜（直接在 Linux 操作系统上安装上述所使用的软件负载均衡，部署及维护较简单，4 层 和 7 层负载均衡可根据业务进行选择也可根据业务特点，比较方便进行扩展及定制功能）；